{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport api from '../utils/api';\nimport { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport useFlashMessage from './useFlashMessage';\nexport default function useAuth() {\n  _s();\n\n  const [authenticated, setAuthenticated] = useState(false);\n  const {\n    setFlashMessage\n  } = useFlashMessage();\n  const navigate = useNavigate();\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n\n    if (token) {\n      api.defaults.headers.Authorization = `Bearer ${JSON.parse(token)}`;\n      setAuthenticated(true);\n    }\n  }, []);\n\n  async function register(user) {\n    let msgText = 'Cadastro realizado com sucesso!';\n    let msgType = 'success';\n\n    try {\n      const data = await api.post('/users/register', user).then(response => {\n        return response.data;\n      });\n      await authUser(data);\n    } catch (error) {\n      msgText = error.response.data.message;\n      msgType = 'error';\n    }\n\n    setFlashMessage(msgText, msgType);\n  }\n\n  async function login(user) {\n    let msgText = 'Login realizado com sucesso!';\n    let msgType = 'success';\n\n    try {\n      const data = await api.post('/users/login', user).then(response => {\n        return;\n      });\n    } catch (error) {\n      msgText = error.response.data.message;\n      msgType = 'error';\n    }\n\n    setFlashMessage(msgText, msgType);\n  }\n\n  async function authUser(data) {\n    setAuthenticated(true);\n    localStorage.setItem('token', JSON.stringify(data.token));\n    navigate('/');\n  }\n\n  function logout() {\n    const msgText = 'Logout realizado com sucesso!';\n    const msgType = 'success';\n    setAuthenticated(false);\n    localStorage.removeItem('token');\n    api.defaults.headers.Authorization = undefined; // api.defaults.headers.Authorization = undefined\n\n    navigate('/');\n    setFlashMessage(msgText, msgType);\n  }\n\n  return {\n    authenticated,\n    register,\n    logout\n  };\n}\n\n_s(useAuth, \"QbrhEAOTUcCTimFVJRfLrCR/cQw=\", false, function () {\n  return [useFlashMessage, useNavigate];\n});","map":{"version":3,"names":["api","useState","useEffect","useNavigate","useFlashMessage","useAuth","authenticated","setAuthenticated","setFlashMessage","navigate","token","localStorage","getItem","defaults","headers","Authorization","JSON","parse","register","user","msgText","msgType","data","post","then","response","authUser","error","message","login","setItem","stringify","logout","removeItem","undefined"],"sources":["/home/dev/Ãrea de Trabalho/Projetos/Sistema de Pet/frontend/src/hooks/useAuth.js"],"sourcesContent":["import api from '../utils/api';\nimport {useState, useEffect} from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport useFlashMessage from './useFlashMessage';\n\nexport default function useAuth(){\n    const [authenticated, setAuthenticated] = useState(false)\n    const {setFlashMessage} = useFlashMessage()\n    const navigate = useNavigate()\n\n    useEffect(() => {\n        const token = localStorage.getItem('token')\n\n        if(token) {\n          api.defaults.headers.Authorization = `Bearer ${JSON.parse(token)}`\n          setAuthenticated(true)\n        }\n    }, [])\n\n    async function register(user){\n\n        let msgText = 'Cadastro realizado com sucesso!'\n        let msgType = 'success'\n\n        try {\n            const data = await api.post('/users/register', user).then((response) => {\n                return response.data\n            })\n\n           await authUser(data)\n        }catch(error){\n            msgText = error.response.data.message\n            msgType = 'error'\n\n        }\n\n        setFlashMessage(msgText, msgType)\n    }\n\n    async function login(user){\n        let msgText = 'Login realizado com sucesso!'\n        let msgType = 'success'\n\n        try{\n\n            const data = await api.post('/users/login', user).then((response) => {\n                return\n            })\n\n        }catch(error){\n            msgText = error.response.data.message\n            msgType = 'error'\n        }\n\n        setFlashMessage(msgText, msgType)\n    }\n\n\n    async function authUser(data){\n\n        setAuthenticated(true)\n        localStorage.setItem('token', JSON.stringify(data.token))\n\n        navigate('/')\n\n    }\n\n    function logout(){\n        const msgText = 'Logout realizado com sucesso!'\n        const msgType = 'success'\n\n        setAuthenticated(false)\n\n        localStorage.removeItem('token')\n        api.defaults.headers.Authorization = undefined\n        // api.defaults.headers.Authorization = undefined\n        navigate('/')\n\n        setFlashMessage(msgText, msgType)\n\n    }\n\n    return {authenticated, register, logout}\n}"],"mappings":";;AAAA,OAAOA,GAAP,MAAgB,cAAhB;AACA,SAAQC,QAAR,EAAkBC,SAAlB,QAAkC,OAAlC;AACA,SAASC,WAAT,QAA4B,kBAA5B;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AAEA,eAAe,SAASC,OAAT,GAAkB;EAAA;;EAC7B,MAAM,CAACC,aAAD,EAAgBC,gBAAhB,IAAoCN,QAAQ,CAAC,KAAD,CAAlD;EACA,MAAM;IAACO;EAAD,IAAoBJ,eAAe,EAAzC;EACA,MAAMK,QAAQ,GAAGN,WAAW,EAA5B;EAEAD,SAAS,CAAC,MAAM;IACZ,MAAMQ,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAd;;IAEA,IAAGF,KAAH,EAAU;MACRV,GAAG,CAACa,QAAJ,CAAaC,OAAb,CAAqBC,aAArB,GAAsC,UAASC,IAAI,CAACC,KAAL,CAAWP,KAAX,CAAkB,EAAjE;MACAH,gBAAgB,CAAC,IAAD,CAAhB;IACD;EACJ,CAPQ,EAON,EAPM,CAAT;;EASA,eAAeW,QAAf,CAAwBC,IAAxB,EAA6B;IAEzB,IAAIC,OAAO,GAAG,iCAAd;IACA,IAAIC,OAAO,GAAG,SAAd;;IAEA,IAAI;MACA,MAAMC,IAAI,GAAG,MAAMtB,GAAG,CAACuB,IAAJ,CAAS,iBAAT,EAA4BJ,IAA5B,EAAkCK,IAAlC,CAAwCC,QAAD,IAAc;QACpE,OAAOA,QAAQ,CAACH,IAAhB;MACH,CAFkB,CAAnB;MAID,MAAMI,QAAQ,CAACJ,IAAD,CAAd;IACF,CAND,CAMC,OAAMK,KAAN,EAAY;MACTP,OAAO,GAAGO,KAAK,CAACF,QAAN,CAAeH,IAAf,CAAoBM,OAA9B;MACAP,OAAO,GAAG,OAAV;IAEH;;IAEDb,eAAe,CAACY,OAAD,EAAUC,OAAV,CAAf;EACH;;EAED,eAAeQ,KAAf,CAAqBV,IAArB,EAA0B;IACtB,IAAIC,OAAO,GAAG,8BAAd;IACA,IAAIC,OAAO,GAAG,SAAd;;IAEA,IAAG;MAEC,MAAMC,IAAI,GAAG,MAAMtB,GAAG,CAACuB,IAAJ,CAAS,cAAT,EAAyBJ,IAAzB,EAA+BK,IAA/B,CAAqCC,QAAD,IAAc;QACjE;MACH,CAFkB,CAAnB;IAIH,CAND,CAMC,OAAME,KAAN,EAAY;MACTP,OAAO,GAAGO,KAAK,CAACF,QAAN,CAAeH,IAAf,CAAoBM,OAA9B;MACAP,OAAO,GAAG,OAAV;IACH;;IAEDb,eAAe,CAACY,OAAD,EAAUC,OAAV,CAAf;EACH;;EAGD,eAAeK,QAAf,CAAwBJ,IAAxB,EAA6B;IAEzBf,gBAAgB,CAAC,IAAD,CAAhB;IACAI,YAAY,CAACmB,OAAb,CAAqB,OAArB,EAA8Bd,IAAI,CAACe,SAAL,CAAeT,IAAI,CAACZ,KAApB,CAA9B;IAEAD,QAAQ,CAAC,GAAD,CAAR;EAEH;;EAED,SAASuB,MAAT,GAAiB;IACb,MAAMZ,OAAO,GAAG,+BAAhB;IACA,MAAMC,OAAO,GAAG,SAAhB;IAEAd,gBAAgB,CAAC,KAAD,CAAhB;IAEAI,YAAY,CAACsB,UAAb,CAAwB,OAAxB;IACAjC,GAAG,CAACa,QAAJ,CAAaC,OAAb,CAAqBC,aAArB,GAAqCmB,SAArC,CAPa,CAQb;;IACAzB,QAAQ,CAAC,GAAD,CAAR;IAEAD,eAAe,CAACY,OAAD,EAAUC,OAAV,CAAf;EAEH;;EAED,OAAO;IAACf,aAAD;IAAgBY,QAAhB;IAA0Bc;EAA1B,CAAP;AACH;;GA9EuB3B,O;UAEMD,e,EACTD,W"},"metadata":{},"sourceType":"module"}